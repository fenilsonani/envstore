## EnvStore

Securely upload, encrypt, version, and manage `.env` files per project and environment.

### Stack

- **Next.js App Router** (TypeScript, React 19)
- **tRPC** for typed API calls
- **Drizzle ORM** with libSQL/Turso
- **Radix UI + Tailwind** components
- **Zod** for validation

## Quick start

1. Install dependencies

```bash
npm install
```

2. Create local env and secrets

```bash
npm run setup-env
# Creates .env.local with a secure JWT_SECRET
```

3. Database

- Default: uses local SQLite (`file:./local.db`)
- Turso (recommended): set the following in `.env.local` before pushing schema

```bash
TURSO_DATABASE_URL="..."
TURSO_AUTH_TOKEN="..."
```

Generate and push schema

```bash
npm run db:generate
npm run db:push
```

4. Start the dev server

```bash
npm run dev
```

Visit `http://localhost:3000`.

## Scripts

- **dev**: start Next.js in dev mode
- **build**: production build
- **start**: run built app
- **lint**: run Next/ESLint
- **typecheck**: strict TypeScript check
- **db:generate**: generate Drizzle migrations
- **db:push**: apply schema to the database

## Environment variables

- **JWT_SECRET**: session signing secret (auto-generated by `setup-env` for local)
- **TURSO_DATABASE_URL**: libSQL/Turso database URL
- **TURSO_AUTH_TOKEN**: Turso auth token

## API surface

### Auth (cookies-based)

- `POST /api/auth/signup`
- `POST /api/auth/login`
- `POST /api/auth/logout`

### tRPC router

- Mounted at `/api/trpc/[trpc]`
- Includes procedures for listing projects/envs, uploading envs, retrieving cipher, and decrypting env content.

### REST (v1)

- `POST /api/v1/env/upload` — upload and encrypt `.env` content
- `GET /api/v1/env/latest` — fetch latest version metadata

## Security

- AES-GCM encryption using Web Crypto Subtle API
- PBKDF2 with 210k iterations to derive keys from a user passphrase
- Only ciphertext, iv, salt and checksum are stored — not the plaintext

## Development

```bash
npm run typecheck
npm run lint
```

### Maintenance tips

- Find unused exports/files/deps:

```bash
npx ts-prune
npx knip --reporter compact
```

## Deploy

Build and run

```bash
npm run build
npm run start
```
